<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ALTA CAL PROFIT SHARE</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 UMD (no JSX, no Babel) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <style>
    html { -webkit-text-size-adjust: 100%; }
    * { -webkit-tap-highlight-color: transparent; }
    input, button { font-size: 16px; }

    /* PRINT: legal page, kill blanks, each calc = its own page */
    @media print {
      @page { size: legal; margin: 0.5in; }
      body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
      .no-print { display: none !important; }
      .print-page { page-break-after: always; }
      .avoid-break-inside { break-inside: avoid; page-break-inside: avoid; }
      /* Scale for accountant readability */
      .print-scale { font-size: 14px; line-height: 1.25; }
      h1.print-title { font-size: 22px; margin-bottom: 10px; }
      h2.print-sub   { font-size: 16px; margin: 8px 0; }
      .print-table { width: 100%; border-collapse: collapse; }
      .print-table th, .print-table td { border: 1px solid #000; padding: 6px 8px; }
    }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script>
    const { useState, useEffect, useMemo } = React;
    const h = React.createElement;

    // ---------- utilities ----------
    const num = (v) => {
      const n = parseFloat(String(v ?? '').replace(/[,$]/g, ''));
      return Number.isFinite(n) ? n : 0;
    };
    const onlyNum = (s) => (String(s||'').replace(/[^0-9.]/g, ''));
    const onlyInt = (s) => (String(s||'').replace(/[^0-9]/g, ''));
    const fmt = (v) => new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(Number(v)||0);

    const defaultHousePct = (contractAmount) => {
      const a = num(contractAmount);
      if (a <= 20000) return 10;
      if (a <= 30000) return 9;
      return 8;
    };

    // derive commission tiers
    function deriveRates(afterFees, afterHouse) {
      const marginPct = afterHouse > 0 ? (afterFees / afterHouse) * 100 : 0;
      let vetRate = 25, repRate = 20;
      if (marginPct >= 50) { vetRate = 55; repRate = 40; }
      else if (marginPct >= 40) { vetRate = 45; repRate = 30; }
      else if (marginPct >= 33) { vetRate = 35; repRate = 25; }
      return { vetRate, repRate, marginPct };
    }

    // calculate per-calculator
    function calcOne(row) {
      const contract = num(row.contractAmount);
      const housePct = row.houseFeePercent ? num(row.houseFeePercent) : defaultHousePct(contract);
      const houseFee = contract * (housePct/100);

      const finance = num(row.financeAmount);
      const dealerPct = num(row.dealerFee);
      const dealerFeeAmount = finance * (dealerPct/100);

      const cc = num(row.creditCard);
      const ccPct = num(row.creditCardFee);
      const ccFeeAmount = cc * (ccPct/100);

      const labor = num(row.laborMaterial);

      const afterHouse = contract - houseFee;
      const afterFees = afterHouse - labor - dealerFeeAmount; // job-costs style (no profit shown anywhere)

      const { vetRate, repRate, marginPct } = deriveRates(afterFees, afterHouse);

      const vets = num(row.numVets);
      const reps = num(row.numReps);
      const people = vets + reps;

      const vetPool = afterFees * (vetRate/100);
      const repPool = afterFees * (repRate/100);

      const perVet = people ? (vetPool / people) : 0;
      const perRep = people ? (repPool / people) : 0;

      const rideAlongFee = num(row.rideAlong);
      const rideAlongBonus = num(row.rideAlongBonus);
      const rideAlongTotal = rideAlongFee + rideAlongBonus;

      const rideAlongPerPerson = people ? (rideAlongFee / people) : 0;
      const ccPerPerson = people ? (ccFeeAmount / people) : 0;

      const finalPerVet = perVet - rideAlongPerPerson - ccPerPerson;
      const finalPerRep = perRep - rideAlongPerPerson - ccPerPerson;

      const totalVets = finalPerVet * vets;
      const totalReps = finalPerRep * reps;

      const raCount = num(row.numRideAlongs);
      const perRA = raCount ? (rideAlongTotal / raCount) : 0;

      return {
        contract, housePct, houseFee,
        finance, dealerPct, dealerFeeAmount,
        cc, ccPct, ccFeeAmount,
        labor,
        afterHouse, afterFees,
        vetRate, repRate, marginPct,
        perVet: finalPerVet, perRep: finalPerRep,
        totalVets, totalReps,
        rideAlongTotal, perRA
      };
    }

    const fit = (arr, count) => {
      const c = Math.max(0, parseInt(count||0,10)||0);
      const base = Array.isArray(arr) ? [...arr] : [];
      if (base.length > c) return base.slice(0,c);
      while (base.length < c) base.push('');
      return base;
    };

    // ---------- printing ----------
    function openPrintWindow(html, title='Print') {
      const win = window.open('', '_blank');
      if (!win) { alert('Pop-up blocked. Please allow pop-ups for this site.'); return; }
      win.document.open();
      win.document.write(`<!doctype html>
        <html><head><meta charset="utf-8"><title>${title}</title>
        <style>
          @page { size: legal; margin: 0.5in; }
          body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Arial, sans-serif; color: #111; }
          .print-page { page-break-after: always; }
          .avoid-break-inside { break-inside: avoid; page-break-inside: avoid; }
          .print-scale { font-size: 14px; line-height: 1.25; }
          h1.print-title { font-size: 22px; margin: 0 0 10px; }
          h2.print-sub { font-size: 16px; margin: 8px 0; }
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #000; padding: 6px 8px; font-size: 14px; }
        </style>
        </head><body>${html}</body></html>`);
      win.document.close();
      setTimeout(()=>{ win.focus(); win.print(); }, 60);
    }

    function buildSingleHTML(row, idx) {
      const c = calcOne(row);
      const vetNames = fit(row.vetNames, row.numVets);
      const repNames = fit(row.repNames, row.numReps);
      const raNames  = fit(row.rideAlongNames, row.numRideAlongs);

      const detail = `
        <div class="print-page print-scale">
          <h1 class="print-title" style="text-align:center;border-bottom:3px solid #000;padding-bottom:6px;">
            ALTA CALCULATOR #${idx+1}
          </h1>

          <table class="avoid-break-inside" style="margin-bottom:12px;">
            <tbody>
              <tr><th>Customer</th><td>${(row.customerName||'').toString().trim() || 'N/A'}</td></tr>
              <tr><th>Job #</th><td>${(row.jobNumber||'').toString().trim() || 'N/A'}</td></tr>
            </tbody>
          </table>

          <h2 class="print-sub">CONTRACT & PAYMENT</h2>
          <table class="avoid-break-inside" style="margin-bottom:12px;">
            <tbody>
              <tr><th>Contract Amount</th><td>${fmt(c.contract)}</td></tr>
              <tr><th>House Fee %</th><td>${c.housePct}%</td></tr>
              <tr><th>House Fee</th><td>${fmt(c.houseFee)}</td></tr>
              <tr><th>Labor & Material</th><td>${fmt(c.labor)}</td></tr>
              <tr><th>Finance Amount</th><td>${fmt(c.finance)}</td></tr>
              <tr><th>Dealer Fee %</th><td>${c.dealerPct}%</td></tr>
              <tr><th>Dealer Fee Amount</th><td>${fmt(c.dealerFeeAmount)}</td></tr>
              <tr><th>Total After Fees</th><td>${fmt(c.afterFees)}</td></tr>
            </tbody>
          </table>

          <h2 class="print-sub">RATES</h2>
          <table class="avoid-break-inside" style="margin-bottom:12px;">
            <tbody>
              <tr><th>Vets %</th><td>${c.vetRate}%</td></tr>
              <tr><th>Reps %</th><td>${c.repRate}%</td></tr>
            </tbody>
          </table>

          ${vetNames.length ? `
            <h2 class="print-sub">VETS</h2>
            <table class="avoid-break-inside" style="margin-bottom:12px;">
              <thead><tr><th style="width:70%">Name</th><th>Payout</th></tr></thead>
              <tbody>
                ${vetNames.map(n=>`<tr><td>${(n||'').toString().trim()}</td><td>${fmt(c.perVet)}</td></tr>`).join('')}
              </tbody>
            </table>` : ''}

          ${repNames.length ? `
            <h2 class="print-sub">REPS</h2>
            <table class="avoid-break-inside" style="margin-bottom:12px;">
              <thead><tr><th style="width:70%">Name</th><th>Payout</th></tr></thead>
              <tbody>
                ${repNames.map(n=>`<tr><td>${(n||'').toString().trim()}</td><td>${fmt(c.perRep)}</td></tr>`).join('')}
              </tbody>
            </table>` : ''}

          ${raNames.length ? `
            <h2 class="print-sub">RIDE ALONGS</h2>
            <table class="avoid-break-inside" style="margin-bottom:12px;">
              <thead><tr><th style="width:70%">Name</th><th>Per Person Payout</th></tr></thead>
              <tbody>
                ${raNames.map(n=>`<tr><td>${(n||'').toString().trim()}</td><td>${fmt(c.perRA)}</td></tr>`).join('')}
              </tbody>
            </table>` : ''}
        </div>
      `;
      return detail;
    }

    function buildReportHTML(rows) {
      // aggregate totals per person across all calculators
      const totals = {}; // { name: amount }
      const push = (name, amt) => {
        const key = (name||'').toString().trim() || '(Unnamed)';
        totals[key] = (totals[key]||0) + amt;
      };

      rows.forEach(row => {
        const c = calcOne(row);
        const vetNames = fit(row.vetNames, row.numVets);
        const repNames = fit(row.repNames, row.numReps);
        const raNames  = fit(row.rideAlongNames, row.numRideAlongs);
        vetNames.forEach(n => push(n, c.perVet));
        repNames.forEach(n => push(n, c.perRep));
        raNames.forEach(n => push(n, c.perRA));
      });

      const people = Object.entries(totals).sort((a,b)=>a[0].localeCompare(b[0]));

      // Summary by file table + person totals at bottom
      const filesTable = rows.map((row, i) => {
        const c = calcOne(row);
        const vets = num(row.numVets), reps=num(row.numReps), ras=num(row.numRideAlongs);
        return `
          <tr>
            <td>${i+1}</td>
            <td>${(row.customerName||'').toString().trim() || 'N/A'}</td>
            <td>${(row.jobNumber||'').toString().trim() || 'N/A'}</td>
            <td class="right">${vets||''}</td>
            <td class="right">${vets?fmt(c.perVet):''}</td>
            <td class="right">${vets?fmt(c.perVet*vets):''}</td>
            <td class="right">${reps||''}</td>
            <td class="right">${reps?fmt(c.perRep):''}</td>
            <td class="right">${reps?fmt(c.perRep*reps):''}</td>
            <td class="right">${ras||''}</td>
            <td class="right">${ras?fmt(c.perRA):''}</td>
            <td class="right">${ras?fmt(c.perRA*ras):''}</td>
          </tr>
        `;
      }).join('');

      const peopleTotals = people.map(([name, amt]) =>
        `<tr><td>${name}</td><td class="right">${fmt(amt)}</td></tr>`
      ).join('');

      return `
        <div class="print-page print-scale">
          <h1 class="print-title" style="text-align:center;border-bottom:3px solid #000;padding-bottom:6px;">
            ALTA CAL PROFIT SHARE — PAYOUT REPORT
          </h1>

          <table class="print-table avoid-break-inside" style="margin-bottom:14px;">
            <thead>
              <tr>
                <th>#</th>
                <th>Customer</th>
                <th>Job #</th>
                <th>Vets</th>
                <th>Per Vet</th>
                <th>Total Vets</th>
                <th>Reps</th>
                <th>Per Rep</th>
                <th>Total Reps</th>
                <th>RAs</th>
                <th>Per RA</th>
                <th>Total RA</th>
              </tr>
            </thead>
            <tbody>${filesTable}</tbody>
          </table>

          <h2 class="print-sub">TOTAL BY PERSON (ALL FILES)</h2>
          <table class="print-table avoid-break-inside">
            <thead><tr><th>Person</th><th>Amount</th></tr></thead>
            <tbody>${peopleTotals || '<tr><td colspan="2" class="right">(No names entered)</td></tr>'}</tbody>
          </table>
        </div>
      `;
    }

    // ---------- UI helpers (no JSX) ----------
    const Label = (text) => h('label', {className:'block text-sm font-bold mb-1 text-gray-700'}, text);
    const TextInput = ({value, onChange, placeholder}) =>
      h('input', {
        className:'w-full border-2 border-gray-300 px-3 py-2 rounded',
        type:'text', value:value||'', placeholder:placeholder||'',
        onChange:(e)=>onChange(e.target.value)
      });
    const MoneyInput = ({label, value, onChange}) => h('div', {}, [
      Label(label),
      h('div', {className:'flex items-center bg-white border-2 rounded px-3 py-3'},
        [h('span',{className:'mr-2'},'$'),
         h('input',{
           className:'w-full text-right focus:outline-none',
           type:'text', inputMode:'decimal', value:value||'',
           onChange:(e)=>onChange(onlyNum(e.target.value))
         })])
    ]);
    const PercentInput = ({label, value, onChange}) => h('div', {}, [
      Label(label),
      h('div', {className:'flex items-center bg-white border-2 rounded px-3 py-3'},
        [h('input',{
           className:'w-full text-right focus:outline-none',
           type:'text', inputMode:'decimal', value:value||'',
           onChange:(e)=>onChange(onlyNum(e.target.value))
         }),
         h('span',{className:'ml-2'},'%')])
    ]);
    const IntInput = ({label, value, onChange}) => h('div', {}, [
      Label(label),
      h('input',{
        className:'w-full text-center text-xl border-2 rounded px-3 py-3',
        type:'text', inputMode:'numeric', value:value||'',
        onChange:(e)=>onChange(onlyInt(e.target.value))
      })
    ]);

    function NamesList({title, count, names, onSetName, color}) {
      if (num(count) <= 0) return null;
      const head = `text-sm font-bold mb-3 text-center border-b-2 border-black pb-2`;
      const border = color==='green'?'border-green-600':color==='purple'?'border-purple-600':color==='red'?'border-red-600':'border-gray-400';
      return h('div', {}, [
        h('h3',{className:head}, title),
        ...Array.from({length:num(count)}, (_,i)=>h('div',{key:i,className:'mb-2'},[
          h('label',{className:'text-xs font-bold block mb-1'}, `${title} ${i+1}`),
          h('input',{
            className:`w-full px-2 py-1 border ${border} rounded`,
            type:'text', value:(names[i]||''),
            onChange:(e)=>onSetName(i, e.target.value)
          })
        ]))
      ]);
    }

    function GroupPayout({label, count, per, totalTitle, color}) {
      if (num(count) <= 0) return null;
      const cardCls = color==='green'
        ? 'bg-green-100 rounded-lg p-6 border-2 border-green-600'
        : color==='purple'
          ? 'bg-purple-100 rounded-lg p-6 border-2 border-purple-600'
          : 'bg-yellow-100 rounded-lg p-6 border-2 border-yellow-600';
      const textCls = color==='green' ? 'text-green-700' : color==='purple' ? 'text-purple-700' : 'text-yellow-700';
      return h('div',{className:'grid grid-cols-1 md:grid-cols-3 gap-4'},[
        h('div',{},[
          h('div',{className:'block text-sm font-bold mb-2 text-center'},label),
          h('div',{className:'text-center text-xl font-bold'}, String(count||0))
        ]),
        h('div',{className:cardCls},[
          h('div',{className:'text-sm font-bold text-center mb-2'},'PER PERSON'),
          h('div',{className:`text-4xl font-bold ${textCls} text-center`}, fmt(per))
        ]),
        h('div',{className:'bg-white rounded-lg p-4 border-2 text-center'},[
          h('div',{className:'text-sm font-bold'}, totalTitle),
          h('div',{className:'text-3xl font-bold'}, fmt(num(count)*num(per)))
        ])
      ]);
    }

    function Section({title, color, children}) {
      const colors = {
        blue: 'bg-blue-50 border-blue-400',
        green: 'bg-green-50 border-green-400',
        orange: 'bg-orange-50 border-orange-400',
        purple: 'bg-purple-50 border-purple-400',
        yellow: 'bg-yellow-50 border-yellow-400',
        gray: 'bg-gray-50 border-gray-300'
      };
      return h('div',{className:`border-4 rounded-lg p-4 ${colors[color]||colors.gray}`},[
        h('h3',{className:'text-xl font-bold mb-4 text-center'}, title),
        children
      ]);
    }

    function CalculatorCard({row, index, rows, setRows, onPrintOne}) {
      const c = useMemo(()=>calcOne(row), [row]);

      const upd = (k, v) => {
        setRows(a=>{
          const x=[...a], r={...x[index]};
          if (k==='contractAmount') {
            r.contractAmount = onlyNum(v);
            // Auto-set house % if user left it blank or followed default previously
            if (!r.houseFeePercent || r.houseFeePercent === String(defaultHousePct(row.contractAmount))) {
              r.houseFeePercent = String(defaultHousePct(r.contractAmount));
            }
          } else if (k==='houseFeePercent') {
            r.houseFeePercent = onlyNum(v);
          } else if (k==='numVets') {
            r.numVets = onlyInt(v);
            r.vetNames = fit(r.vetNames, r.numVets);
          } else if (k==='numReps') {
            r.numReps = onlyInt(v);
            r.repNames = fit(r.repNames, r.numReps);
          } else if (k==='numRideAlongs') {
            r.numRideAlongs = onlyInt(v);
            r.rideAlongNames = fit(r.rideAlongNames, r.numRideAlongs);
          } else {
            r[k] = v;
          }
          x[index]=r; return x;
        });
      };

      const setName = (kind, i, val) => {
        setRows(a=>{
          const x=[...a], r={...x[index]};
          const key = kind==='vet'?'vetNames':kind==='rep'?'repNames':'rideAlongNames';
          r[key] = fit(r[key], kind==='vet'?r.numVets:kind==='rep'?r.numReps:r.numRideAlongs);
          r[key][i] = val;
          x[index]=r; return x;
        });
      };

      return h('div',{className:'relative mb-6 bg-white border-4 border-gray-300 rounded-lg'},[
        h('div',{className:'bg-blue-300 text-center py-2 border-b-2 border-black flex justify-between items-center px-4'},[
          h('div', {style:{width:'2rem'}}),
          h('h2',{className:'text-lg font-bold'}, `CALCULATOR #${index+1}`),
          h('button',{
            className:'bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded',
            onClick:()=>onPrintOne(index)
          }, 'PRINT')
        ]),

        // Header fields
        h('div',{className:'grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 border-b-2 border-black'},[
          h('div',{},[Label('CUSTOMER NAME'), TextInput({
            value:row.customerName, onChange:(v)=>upd('customerName', v), placeholder:'Enter customer name'
          })]),
          h('div',{},[Label('JOB NUMBER'), TextInput({
            value:row.jobNumber, onChange:(v)=>upd('jobNumber', v), placeholder:'Enter job number'
          })])
        ]),

        h('div',{className:'p-6 space-y-6'},[
          h(Section,{title:'CONTRACT & PAYMENT', color:'blue'},[
            h('div',{className:'grid grid-cols-1 md:grid-cols-3 gap-4'},[
              MoneyInput({label:'CONTRACT AMOUNT', value:row.contractAmount, onChange:(v)=>upd('contractAmount', v)}),
              MoneyInput({label:'CASH/CHECK', value:row.cashCheck, onChange:(v)=>upd('cashCheck', v)}),
              MoneyInput({label:'LABOR & MATERIAL', value:row.laborMaterial, onChange:(v)=>upd('laborMaterial', v)}),
            ])
          ]),

          h(Section,{title:'FINANCE INFO', color:'green'},[
            h('div',{className:'grid grid-cols-1 md:grid-cols-2 gap-6'},[
              h('div',{},[
                MoneyInput({label:'FINANCE AMOUNT', value:row.financeAmount, onChange:(v)=>upd('financeAmount', v)}),
                PercentInput({label:'DEALER FEE (%)', value:row.dealerFee, onChange:(v)=>upd('dealerFee', v)}),
                h('div',{className:'text-center text-sm font-bold text-green-700 mt-1'}, fmt(num(row.financeAmount)*num(row.dealerFee)/100))
              ]),
              h('div',{},[
                MoneyInput({label:'CREDIT CARD', value:row.creditCard, onChange:(v)=>upd('creditCard', v)}),
                PercentInput({label:'CC FEE (%)', value:row.creditCardFee, onChange:(v)=>upd('creditCardFee', v)}),
                h('div',{className:'text-center text-sm font-bold text-green-700 mt-1'}, fmt(num(row.creditCard)*num(row.creditCardFee)/100))
              ])
            ])
          ]),

          h(Section,{title:'FEES & BONUSES', color:'orange'},[
            h('div',{className:'grid grid-cols-1 md:grid-cols-3 gap-4'},[
              h('div',{},[
                PercentInput({label:'HOUSE FEE % (auto if blank)', value:row.houseFeePercent, onChange:(v)=>upd('houseFeePercent', v)}),
                h('div',{className:'text-center text-lg font-bold mt-2'}, `House: ${fmt(c.houseFee)}`),
                h('div',{className:'text-xs text-center text-gray-600 mt-1'}, 'Auto: 10% ≤ $20k; 9% ≤ $30k; 8% > $30k')
              ]),
              h('div',{},[
                MoneyInput({label:'RIDE ALONG FEE', value:row.rideAlong, onChange:(v)=>upd('rideAlong', v)}),
                h('div',{className:'text-center text-sm font-bold mt-1'}, `Per Person Split: ${fmt((num(row.rideAlong)/(num(row.numVets)+num(row.numReps) || 1)))}`)
              ]),
              MoneyInput({label:'RIDE ALONG BONUS', value:row.rideAlongBonus, onChange:(v)=>upd('rideAlongBonus', v)}),
            ])
          ]),

          h(Section,{title:'CALCULATED TOTALS', color:'purple'},[
            h('div',{className:'grid grid-cols-1 md:grid-cols-3 gap-4'},[
              h('div',{className:'bg-white rounded-lg p-4 border-2 text-center'},[
                h('div',{className:'text-sm font-bold mb-1'},'TOTAL AFTER FEES'),
                h('div',{className:'text-3xl font-bold'}, fmt(c.afterFees))
              ]),
              h('div',{className:'bg-white rounded-lg p-4 border-2 text-center'},[
                h('div',{className:'text-sm font-bold mb-1'},'VETS %'),
                h('div',{className:'text-3xl font-bold'}, `${c.vetRate}%`)
              ]),
              h('div',{className:'bg-white rounded-lg p-4 border-2 text-center'},[
                h('div',{className:'text-sm font-bold mb-1'},'REP %'),
                h('div',{className:'text-3xl font-bold'}, `${c.repRate}%`)
              ])
            ])
          ]),

          // Names + payouts
          h('div',{className:'grid grid-cols-1 md:grid-cols-3 gap-6'},[
            h('div',{},[
              IntInput({label:'VETS ON CONTRACT', value:row.numVets, onChange:(v)=>upd('numVets', v)}),
              GroupPayout({label:'VETS ON CONTRACT', count:row.numVets, per:c.perVet, totalTitle:'TOTAL VET PAYOUT', color:'green'}),
              NamesList({title:'VET', count:row.numVets, names:fit(row.vetNames,row.numVets), onSetName:(i,v)=>setName('vet',i,v), color:'green'})
            ]),
            h('div',{},[
              IntInput({label:'REPS ON CONTRACT', value:row.numReps, onChange:(v)=>upd('numReps', v)}),
              GroupPayout({label:'REPS ON CONTRACT', count:row.numReps, per:c.perRep, totalTitle:'TOTAL REP PAYOUT', color:'purple'}),
              NamesList({title:'REP', count:row.numReps, names:fit(row.repNames,row.numReps), onSetName:(i,v)=>setName('rep',i,v), color:'purple'})
            ]),
            h('div',{},[
              IntInput({label:'RIDE ALONGS', value:row.numRideAlongs, onChange:(v)=>upd('numRideAlongs', v)}),
              num(row.numRideAlongs) > 0
                ? h('div',{className:'bg-yellow-100 rounded-lg p-4 border-2 border-yellow-600 text-center mb-3'},[
                    h('div',{className:'text-sm font-bold'},'PER RIDE ALONG'),
                    h('div',{className:'text-3xl font-bold text-yellow-700'}, fmt(c.perRA)),
                    h('div',{className:'text-sm font-bold mt-1'},`Total RA Payout: ${fmt(c.rideAlongTotal)}`)
                  ])
                : null,
              NamesList({title:'RIDE ALONG', count:row.numRideAlongs, names:fit(row.rideAlongNames,row.numRideAlongs), onSetName:(i,v)=>setName('rideAlong',i,v), color:'red'})
            ])
          ])
        ])
      ]);
    }

    function App(){
      const blank = ()=>({
        id: Date.now()+Math.random(),
        customerName:'', jobNumber:'',
        contractAmount:'', cashCheck:'',
        financeAmount:'', dealerFee:'',
        creditCard:'', creditCardFee:'',
        houseFeePercent:'', // auto if left blank
        laborMaterial:'',
        rideAlong:'', rideAlongBonus:'',
        numVets:'', numReps:'',
        numRideAlongs:'',
        vetNames:[], repNames:[], rideAlongNames:[]
      });

      const [rows, setRows] = useState([blank()]);

      const printOne = (i) => {
        openPrintWindow(buildSingleHTML(rows[i], i), `Calculator #${i+1}`);
      };
      const printReport = () => {
        openPrintWindow(buildReportHTML(rows), 'Payout Report');
      };

      return h('div',{className:'max-w-6xl mx-auto p-4'},[
        h('div',{className:'bg-white rounded-lg shadow-lg p-4 mb-4 border-4 border-blue-500'},[
          h('div',{className:'flex items-center justify-between header-wrap'},[
            h('h1',{className:'text-2xl font-bold text-blue-800'},'ALTA CAL PROFIT SHARE'),
            h('div',{className:'header-actions flex gap-2'},[
              h('button',{
                className:'bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded',
                onClick:printReport
              },'PRINT REPORT'),
              h('button',{
                className:'bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded',
                onClick:()=>setRows(r=>[...r, blank()])
              },'ADD FILE')
            ])
          ])
        ]),

        ...rows.map((row, i) =>
          h(CalculatorCard,{key:row.id, row, index:i, rows, setRows, onPrintOne:printOne})
        )
      ]);
    }

    // Mount once; no Babel = no iOS blank
    ReactDOM.createRoot(document.getElementById('root')).render(h(App));

  </script>
</body>
</html>
